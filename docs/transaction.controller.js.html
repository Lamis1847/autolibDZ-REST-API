<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: transaction.controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: transaction.controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const db = require("../models");
const Transaction = db.transaction;
const { Op } = require("sequelize");


/**
 * Filter user transactions
 * @param {*} req The request
 * @param {*} res The response
* @returns {object} A list of filtered transactions
 */

const filterTransaction = async (req, res) => {

     // Validate request
     if (!req.params.id) {
          res.status(400).send({
               message: "Id locataire can not be empty!"
          });
          return;
     }

     var options = {};

     //let reservation = req.body.reseravation;
     let dateTransaction = req.body.dateTransaction;
     let dateFrom = req.body.dateFrom;
     let dateTo = req.body.dateTo;

     let montant = req.body.montant;
     let montantFrom = req.body.montantFrom;
     let montantTo = req.body.montantTo;

     let moyenPayement = req.body.moyenPayement


     if (montant) {
          options.montant = {
               [Op.eq]: montant
          }
     }
     if (montantFrom) {
          options.montant = {
               [Op.gte]: montantFrom
          }
     }
     if (montantTo) {
          options.montant = {
               [Op.lt]: montantTo
          }
     }

     if (dateTransaction) {
          options.dateTransaction = {
               [Op.eq]: dateTransaction
          }
     }
     if (dateFrom) {
          options.dateTransaction = {
               [Op.gte]: dateFrom
          }
     }
     if (dateTo) {
          options.dateTransaction = {
               [Op.lt]: prixTo
          }
     }

     if (moyenPayement) {
          options.moyenPayement = moyenPayement
     }

     console.log(options)

     // Save Transaction in the database
     try {
          const id = req.params.id
          let locataire = await Transaction.findAll({
               where: {
                    idLocataire: id
               }
          })
          if (locataire.length > 0) {
               let transactions = await Transaction.findAll({
                    where: {
                         [Op.and]: [
                              { idLocataire: id },
                              options
                         ]
                    }
               })
               if (transactions.length &lt;= 0) {
                    res.status(404).send({
                         error: "There is no transaction with these parameters."
                    });
               } else {
                    res.status(200).send(transactions);
               }
          } else {
               res.status(404).send({ "error": "le locataire avec id " + id + " n'a pas encore de transactions." })
          }
     }
     catch (err) {
          res.status(500).send({
               error: err.message || "Some error occurred while filtering Transaction."
          });
     }
}

export default {
     filterTransaction
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#createBorne">createBorne</a></li><li><a href="global.html#filterTransaction">filterTransaction</a></li><li><a href="global.html#getAllBornes">getAllBornes</a></li><li><a href="global.html#getBorne">getBorne</a></li><li><a href="global.html#getFilteredBornes">getFilteredBornes</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.7</a> on Thu May 20 2021 10:38:42 GMT+0100 (heure normale dâ€™Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
